#!/bin/sh
# agent-rdp CLI wrapper
# Detects OS/arch and runs the appropriate native binary

SCRIPT="$0"
while [ -L "$SCRIPT" ]; do
  SCRIPT_DIR="$(cd "$(dirname "$SCRIPT")" && pwd)"
  SCRIPT="$(readlink "$SCRIPT")"
  case "$SCRIPT" in /*) ;; *) SCRIPT="$SCRIPT_DIR/$SCRIPT" ;; esac
done
SCRIPT_DIR="$(cd "$(dirname "$SCRIPT")" && pwd)"

OS=$(uname -s | tr '[:upper:]' '[:lower:]')
ARCH=$(uname -m)
case "$OS" in darwin) OS="darwin" ;; linux) OS="linux" ;; mingw*|msys*|cygwin*) OS="win32" ;; esac
case "$ARCH" in x86_64|amd64) ARCH="x64" ;; aarch64|arm64) ARCH="arm64" ;; esac

BINARY="$SCRIPT_DIR/agent-rdp-${OS}-${ARCH}"

if [ -f "$BINARY" ] && [ -x "$BINARY" ]; then
  exec "$BINARY" "$@"
fi

echo "Error: No binary found for ${OS}-${ARCH}" >&2
echo "Expected: $BINARY" >&2
echo "" >&2
echo "To build locally:" >&2
echo "  1. Install Rust: https://rustup.rs" >&2
echo "  2. Run: npm run build:native" >&2
exit 1
